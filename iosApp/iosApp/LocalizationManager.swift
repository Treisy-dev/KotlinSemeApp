import Foundation
import shared

class LocalizationManager: ObservableObject {
    static let shared = LocalizationManager()
    
    @Published var currentLanguage: String = "en"
    
    private let settingsViewModel: SettingsViewModel
    
    private init() {
        self.settingsViewModel = getSettingsViewModel()
        setupLanguageObserver()
    }
    
    private func setupLanguageObserver() {
        // Observe language changes from KMM
        Timer.scheduledTimer(withTimeInterval: 0.1, repeats: true) { [weak self] _ in
            guard let self = self else { return }
            guard let state = self.settingsViewModel.state.value as? SettingsState else { return }
            
            DispatchQueue.main.async {
                if self.currentLanguage != state.language {
                    self.currentLanguage = state.language
                    print("üåç Language updated: \(self.currentLanguage)")
                }
            }
        }
    }
    
    func getString(_ key: String) -> String {
        return Strings.get(key: key, language: currentLanguage)
    }
    
    func setLanguage(_ language: String) {
        settingsViewModel.handleEvent(event: SettingsEvent.SetLanguage(language: language))
    }
}

// Localization strings
struct Strings {
    private static let strings: [String: [String: String]] = [
        "en": [
            // Tab Bar
            "chat": "Chat",
            "history": "History",
            "prompts": "Prompts",
            "settings": "Settings",
            
            // Chat Screen
            "chat_title": "Chat",
            "chat_new_session": "New Chat",
            "chat_placeholder": "Type a message...",
            "chat_send": "Send",
            "chat_loading": "Sending...",
            "chat_error": "Send Error",
            "chat_attach_image": "Attach Image",
            "chat_take_photo": "Take Photo",
            "chat_typing": "AI is typing...",
            "chat_retry": "Retry",
            "chat_copy_message": "Copy message",
            "chat_message_copied": "Message copied to clipboard",
            "chat_copy_failed": "Failed to copy message",
            "chat_subtitle": "Ask Gemini anything or share an image for analysis",
            
            // History Screen
            "history_title": "History",
            "history_empty": "History is empty",
            "history_subtitle": "Start a new conversation to see it here",
            "history_filter_all": "All",
            "history_filter_text": "Text only",
            "history_filter_image": "With images",
            "history_delete": "Delete",
            "history_share": "Share",
            "history_copy": "Copy",
            "history_no_messages": "No messages in this conversation",
            
            // Prompt Screen
            "prompt_title": "New Prompt",
            "prompt_placeholder": "Describe what you want...",
            "prompt_send": "Send",
            "prompt_loading": "Sending...",
            "prompt_error": "Send Error",
            "prompt_clear": "Clear",
            "prompt_examples": "Example Prompts",
            "prompt_example_1": "Write a story about...",
            "prompt_example_2": "Explain how to...",
            "prompt_example_3": "Create a poem about...",
            "prompt_add_image": "Add Image (Optional)",
            "prompt_gallery": "Gallery",
            "prompt_camera": "Camera",
            "prompt_remove_image": "Remove Image",
            
            // Settings Screen
            "settings_title": "Settings",
            "settings_theme": "Theme",
            "settings_language": "Language",
            "settings_data_management": "Data Management",
            "settings_about": "About",
            "theme_light": "Light",
            "theme_dark": "Dark",
            "theme_system": "System",
            "theme_mode": "Theme Mode",
            "theme_dark_description": "Use dark theme",
            "language_english": "English",
            "language_russian": "Russian",
            "clear_all_data": "Clear All Data",
            "clear_all_data_description": "This will delete all chat history and settings",
            "app_name_full": "SemeApp - AI Chat",
            "app_version": "Version 1.0.0",
            "powered_by": "Powered by Google Gemini AI",
            "build": "Build",
            "privacy_policy": "Privacy Policy",
            "terms_of_service": "Terms of Service",
            
            // Common
            "error": "Error",
            "success": "Success",
            "loading": "Loading...",
            "cancel": "Cancel",
            "ok": "OK",
            "yes": "Yes",
            "no": "No",
            "delete": "Delete",
            "share": "Share",
            "copy": "Copy",
            "paste": "Paste",
            "select": "Select",
            "save": "Save",
            "edit": "Edit",
            "close": "Close",
            "back": "Back",
            "next": "Next",
            "previous": "Previous",
            "done": "Done",
            "continue": "Continue"
        ],
        "ru": [
            // Tab Bar
            "chat": "–ß–∞—Ç",
            "history": "–ò—Å—Ç–æ—Ä–∏—è",
            "prompts": "–ü—Ä–æ–º–ø—Ç—ã",
            "settings": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
            
            // Chat Screen
            "chat_title": "–ß–∞—Ç",
            "chat_new_session": "–ù–æ–≤—ã–π —á–∞—Ç",
            "chat_placeholder": "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...",
            "chat_send": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
            "chat_loading": "–û—Ç–ø—Ä–∞–≤–∫–∞...",
            "chat_error": "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
            "chat_attach_image": "–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
            "chat_take_photo": "–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ",
            "chat_typing": "AI –ø–µ—á–∞—Ç–∞–µ—Ç...",
            "chat_retry": "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å",
            "chat_copy_message": "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "chat_message_copied": "–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞",
            "chat_copy_failed": "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "chat_subtitle": "–°–ø—Ä–æ—Å–∏—Ç–µ Gemini —á—Ç–æ —É–≥–æ–¥–Ω–æ –∏–ª–∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞",
            
            // History Screen
            "history_title": "–ò—Å—Ç–æ—Ä–∏—è",
            "history_empty": "–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞",
            "history_subtitle": "–ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ–≥–æ –∑–¥–µ—Å—å",
            "history_filter_all": "–í—Å–µ",
            "history_filter_text": "–¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç",
            "history_filter_image": "–° –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏",
            "history_delete": "–£–¥–∞–ª–∏—Ç—å",
            "history_share": "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
            "history_copy": "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
            "history_no_messages": "–í —ç—Ç–æ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–µ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π",
            
            // Prompt Screen
            "prompt_title": "–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å",
            "prompt_placeholder": "–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ...",
            "prompt_send": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
            "prompt_loading": "–û—Ç–ø—Ä–∞–≤–∫–∞...",
            "prompt_error": "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
            "prompt_clear": "–û—á–∏—Å—Ç–∏—Ç—å",
            "prompt_examples": "–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤",
            "prompt_example_1": "–ù–∞–ø–∏—à–∏ –∏—Å—Ç–æ—Ä–∏—é –æ...",
            "prompt_example_2": "–û–±—ä—è—Å–Ω–∏ –∫–∞–∫...",
            "prompt_example_3": "–°–æ–∑–¥–∞–π —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ –æ...",
            "prompt_add_image": "–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
            "prompt_gallery": "–ì–∞–ª–µ—Ä–µ—è",
            "prompt_camera": "–ö–∞–º–µ—Ä–∞",
            "prompt_remove_image": "–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
            
            // Settings Screen
            "settings_title": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
            "settings_theme": "–¢–µ–º–∞",
            "settings_language": "–Ø–∑—ã–∫",
            "settings_data_management": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏",
            "settings_about": "–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏",
            "theme_light": "–°–≤–µ—Ç–ª–∞—è",
            "theme_dark": "–¢—ë–º–Ω–∞—è",
            "theme_system": "–°–∏—Å—Ç–µ–º–Ω–∞—è",
            "theme_mode": "–†–µ–∂–∏–º —Ç–µ–º—ã",
            "theme_dark_description": "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—ë–º–Ω—É—é —Ç–µ–º—É",
            "language_english": "English",
            "language_russian": "–†—É—Å—Å–∫–∏–π",
            "clear_all_data": "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ",
            "clear_all_data_description": "–≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",
            "app_name_full": "SemeApp - AI –ß–∞—Ç",
            "app_version": "–í–µ—Ä—Å–∏—è 1.0.0",
            "powered_by": "–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Google Gemini AI",
            "build": "–°–±–æ—Ä–∫–∞",
            "privacy_policy": "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
            "terms_of_service": "–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",
            
            // Common
            "error": "–û—à–∏–±–∫–∞",
            "success": "–£—Å–ø–µ—à–Ω–æ",
            "loading": "–ó–∞–≥—Ä—É–∑–∫–∞...",
            "cancel": "–û—Ç–º–µ–Ω–∞",
            "ok": "–û–ö",
            "yes": "–î–∞",
            "no": "–ù–µ—Ç",
            "delete": "–£–¥–∞–ª–∏—Ç—å",
            "share": "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
            "copy": "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
            "paste": "–í—Å—Ç–∞–≤–∏—Ç—å",
            "select": "–í—ã–±—Ä–∞—Ç—å",
            "save": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
            "edit": "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",
            "close": "–ó–∞–∫—Ä—ã—Ç—å",
            "back": "–ù–∞–∑–∞–¥",
            "next": "–î–∞–ª–µ–µ",
            "previous": "–ü—Ä–µ–¥—ã–¥—É—â–∏–π",
            "done": "–ì–æ—Ç–æ–≤–æ",
            "continue": "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
        ]
    ]
    
    static func get(key: String, language: String = "en") -> String {
        return strings[language]?[key] ?? strings["en"]?[key] ?? key
    }
} 